<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	 
<mapper namespace="com.busience.productionLX.dao.ProResultDao">
	<select id="proResultSelectDao" resultType="com.busience.productionLX.dto.ProductionMgmtDto">
	<![CDATA[
		SELECT 
			WorkOrder_No as PRODUCTION_WorkOrder_No, WorkOrder_ONo as PRODUCTION_WorkOrder_ONo, WorkOrder_ItemCode as PRODUCTION_Product_Code, 
			WorkOrder_EquipCode as PRODUCTION_Equipment_Code, pit.Product_Item_Name as PRODUCTION_Product_Name, eit.Equipment_Info_Name as PRODUCTION_Equipment_Name,
			WorkOrder_ProductionQty as PRODUCTION_Qty, WorkOrder_CompleteTime as PRODUCTION_Date
		FROM WorkOrder_tbl wot
		INNER JOIN Product_Info_tbl pit ON wot.WorkOrder_ItemCode = pit.Product_Item_Code 
		INNER JOIN Equipment_Info_tbl eit ON wot.WorkOrder_EquipCode = eit.Equipment_Info_Code
		WHERE WorkOrder_CompleteTime >= #{startDate} AND WorkOrder_CompleteTime < #{endDate} AND WorkOrder_ItemCode LIKE CONCAT('%',#{itemCode},'%') 
			AND pit.Product_Item_Name LIKE CONCAT('%',#{itemName},'%') AND WorkOrder_EquipCode LIKE CONCAT('%',#{machineCode},'%') AND eit.Equipment_Info_Name LIKE CONCAT('%',#{machineName},'%')
		ORDER BY WorkOrder_ItemCode, WorkOrder_ONo, WorkOrder_No
	]]>
	</select>

	<select id="workOrderDetailDao" resultType="com.busience.productionLX.dto.WorkOrderDto">
		SELECT A.WorkOrder_ItemCode, B.PRODUCT_ITEM_NAME WorkOrder_ItemName, A.WorkOrder_EquipCode, C.EQUIPMENT_INFO_NAME WorkOrder_EquipName
			FROM (
				select WorkOrder_ItemCode, WorkOrder_EquipCode
				from WorkOrder_tbl where WorkOrder_ONo = #{WorkOrder_ONo}
			) A
			inner join PRODUCT_INFO_TBL B on A.WorkOrder_ItemCode = B.PRODUCT_ITEM_CODE
			inner join EQUIPMENT_INFO_TBL C on A.WorkOrder_EquipCode = C.EQUIPMENT_INFO_CODE
	</select>
	
	<update id="proResultUpdateDao">
		update WorkOrder_tbl
			set
			WorkOrder_ProductionQty = #{PRODUCTION_Qty}
			where WorkOrder_ONo = #{PRODUCTION_WorkOrder_ONo}
	</update>
</mapper>