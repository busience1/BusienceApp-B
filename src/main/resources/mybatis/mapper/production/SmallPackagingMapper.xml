<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.busience.production.dao.SmallPackagingDao">
	<select id="smallPackagingListSelect" resultType="com.busience.production.dto.Small_Packaging_tbl">
		SELECT spt.Small_Packaging_LotNo, spt.ItemCode, pit.Product_Item_Name ItemName, spt.MachineCode, eit.Equipment_Info_Name MachineName, pit.Product_Info_STND_1 ItemSTND1, pit.Product_Info_STND_2 ItemSTND2, dt.Child_TBL_Type ItemClsfc1, 
			dt2.Child_TBL_Type ItemClsfc2, dt3.Child_TBL_Type ItemMaterial, sum(spt.Qty) Qty, spt.Create_Date 
		FROM Small_Packaging_tbl spt
		INNER JOIN Product_Info_tbl pit ON spt.ItemCode = pit.Product_Item_Code 
		INNER JOIN Equipment_Info_tbl eit ON spt.MachineCode = eit.Equipment_Info_Code
		INNER JOIN DTL_TBL dt ON pit.PRODUCT_ITEM_CLSFC_1 = dt.CHILD_TBL_NO
		INNER JOIN DTL_TBL dt2 ON pit.PRODUCT_ITEM_CLSFC_2 = dt2.CHILD_TBL_NO
		INNER JOIN DTL_TBL dt3 ON pit.Product_Material = dt3.Child_TBL_No
		<![CDATA[
		WHERE spt.Create_Date >= #{startDate} AND spt.Create_Date < #{endDate}
		]]>
		<if test="MachineCode != ''">
		AND spt.MachineCode LIKE CONCAT('%',#{MachineCode},'%')
		</if>
		GROUP BY spt.Small_Packaging_LotNo WITH ROLLUP
	</select>
</mapper>	
