<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.busience.system.dao.MenuMgmtDao">
	<select id="menuMgmtParentListDao" resultType="com.busience.common.dto.DtlDto">
		select A.CHILD_TBL_NO, A.NEW_TBL_CODE, A.CHILD_TBL_NUM, A.CHILD_TBL_TYPE,
			A.CHILD_TBL_RMARK, A.CHILD_TBL_USE_STATUS, B.User_Code
		from (select * from DTL_TBL where NEW_TBL_CODE = '16') A
		left outer join (
			select distinct User_Code, cast(left(Program_Code,2) as signed) as Program_Code
		    from User_Menu_tbl where User_Code = #{User_Code}
		) B on A.CHILD_TBL_NUM = B.Program_Code
				
	</select>

	<select id="menuMgmtListDao" resultType="com.busience.system.dto.MenuMgmtDto">
		select A.Menu_Code, A.Menu_Parent_No, B.CHILD_TBL_TYPE, A.Menu_Child_No, A.Menu_Name Menu_Program_Name,
			A.Menu_PageName, C.Menu_Read_Use_Status, C.Menu_Write_Use_Status, C.Menu_Delete_Use_Status, C.Menu_MGMT_Use_Status, D.User_Code
		from Menu_tbl A
		inner join (
			select * from DTL_TBL where NEW_TBL_CODE = '16'
		) B on A.Menu_Parent_No = cast(B.CHILD_TBL_NUM as signed)
		inner join (
			select * from Menu_MGMT_tbl where Menu_User_Code = #{User_Code}
		) C on A.Menu_Code = C.Menu_Program_Code
		left outer join (
			select * from User_Menu_tbl where User_Code = #{User_Code}
		) D on A.Menu_Code = D.Program_Code;
	</select>
	
	<update id="menuMgmtUpdateDao">
		update Menu_MGMT_tbl
		set
		Menu_Read_Use_Status = #{Menu_Read_Use_Status},
		Menu_Write_Use_Status = #{Menu_Write_Use_Status},
		Menu_Delete_Use_Status = #{Menu_Delete_Use_Status},
		Menu_MGMT_Use_Status = #{Menu_MGMT_Use_Status}
		where Menu_User_Code = #{Menu_User_Code}
		and Menu_Program_Code = #{Menu_Program_Code}
	</update>
</mapper>